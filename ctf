#! /usr/bin/env python
# -*- encoding: utf-8 -*-

import argparse

from nizkctf.cli import scoreboard
from nizkctf.cli import team


def cmd_scoreboard(args):
    with open('accepted-submissions.json', 'r') as f:
        ranking, submissions = scoreboard.rank(f)
    scoreboard.pprint(ranking, top=args.top)

    if args.chart:
        scoreboard.plot(ranking, submissions)

def cmd_register(args):
    team.register(args.name, 'public')


def test(args):
    print('test')


def main():
    commands = {
        'score': cmd_scoreboard,
        'register': cmd_register,
        'test': test,
    }

    parser = argparse.ArgumentParser(description='nizk CTF cli')
    subparsers = parser.add_subparsers(help='command help')

    parser_score = subparsers.add_parser('score', help='scoreboard help')
    parser_score.set_defaults(command='score')
    parser_score.add_argument('--top', type=int,
                              default=0, metavar='N',
                              help='size of ranking to display')
    parser_score.add_argument('--chart', type=bool,
                              default=False, metavar='T/F',
                              help='display chart (true or false).')

    parser_score = subparsers.add_parser('register', help='register a new team')
    parser_score.set_defaults(command='register')
    parser.add_argument('name', metavar='NAME', help='team name')

    args = parser.parse_args()
    commands[args.command](args)

if __name__ == '__main__':
    main()
